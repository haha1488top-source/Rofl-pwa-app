<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#007bff">
    <title>Rico PWA</title>
    
    <!-- iOS –º–µ—Ç–∞—Ç–µ–≥–∏ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Rico">
    <link rel="apple-touch-icon" href="./img/icon.png">
    
    <!-- PWA –º–µ—Ç–∞—Ç–µ–≥–∏ -->
    <link rel="icon" type="image/png" href="./img/icon.png">
    <link rel="manifest" href="./manifest.json">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #007bff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: Arial, sans-serif;
            padding: 20px;
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }

        /* –ü–ê–ù–ï–õ–¨ –ú–û–ù–ï–¢ */
        .coin-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .coin-icon {
            font-size: 24px;
        }

        .container {
            text-align: center;
        }
        
        .counter {
            font-size: 42px;
            color: white;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .rico-image {
            width: 300px;
            height: 300px;
            cursor: pointer;
            transition: transform 0.1s;
            user-select: none;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .rico-image:active {
            transform: scale(0.9);
        }
        
        .install-btn {
            margin: 10px 0;
            padding: 15px 30px;
            font-size: 18px;
            background: white;
            color: #007bff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            width: 80%;
            max-width: 280px;
        }

        /* –°–ü–õ–ò–í–ê–Æ–ß–ï –í–Ü–ö–ù–û PWA */
        .pwa-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 10000;
            display: none;
            flex-direction: column;
            gap: 15px;
            max-width: 300px;
            width: 90%;
            text-align: center;
        }

        .pwa-toast.show {
            display: flex;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        .pwa-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .pwa-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .pwa-install-btn {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .pwa-cancel-btn {
            padding: 10px 20px;
            background: #ff5722;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <!-- –ü–ê–ù–ï–õ–¨ –ú–û–ù–ï–¢ -->
    <div class="coin-panel">
        <span class="coin-icon">ü™ô</span>
        <span id="coinCount">0</span>
    </div>

    <!-- –°–ü–õ–ò–í–ê–Æ–ß–ï –í–Ü–ö–ù–û PWA -->
    <div class="pwa-toast" id="pwaToast">
        <div class="pwa-title">üì± –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫?</div>
        <div class="pwa-buttons">
            <button class="pwa-install-btn" onclick="installPWA()">–¢–∞–∫</button>
            <button class="pwa-cancel-btn" onclick="hidePWAToast()">–ù—ñ</button>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–ê –°–¶–ï–ù–ê -->
    <div class="container">
        <div class="counter">–ö–ª—ñ–∫—ñ–≤: <span id="count">0</span></div>
        <!-- –ö–ê–†–¢–ò–ù–ö–ê RICO -->
        <img src="./img/rico_egg_rico_pin.png" alt="Rico" class="rico-image" id="clicker">
        <button class="install-btn" id="installButton" style="display: none;">–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫</button>
        <div class="status" id="status">–ì—Ä–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞! –¢–∏—Å–Ω–∏ –Ω–∞ Rico üëÜ</div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
        let count = parseInt(localStorage.getItem('clickCount')) || 0;
        let coins = parseInt(localStorage.getItem('gameCoins')) || 0;
        let deferredPrompt;
        let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        let isAndroid = /Android/.test(navigator.userAgent);

        const counterElement = document.getElementById('count');
        const coinCountElement = document.getElementById('coinCount');
        const clickerImg = document.getElementById('clicker');
        const statusElement = document.getElementById('status');
        const pwaToast = document.getElementById('pwaToast');
        const installButton = document.getElementById('installButton');

        function updateCounter() {
            counterElement.textContent = count;
            coinCountElement.textContent = coins;
            localStorage.setItem('clickCount', count);
            localStorage.setItem('gameCoins', coins);
        }

        function handleClick() {
            count += 1;
            coins += Math.floor(Math.random() * 3) + 1; // 1-3 –º–æ–Ω–µ—Ç–∏ –∑–∞ –∫–ª—ñ–∫
            updateCounter();
        }

        // –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –æ–±—Ä–æ–±–Ω–∏–∫ PWA –¥–ª—è Android Chrome
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt fired!', e);
            e.preventDefault();
            deferredPrompt = e;
            
            // –î–ª—è Android Chrome –ø–æ–∫–∞–∑—É—î–º–æ —Å–ø–ª–∏–≤–∞—é—á–µ –≤—ñ–∫–Ω–æ –æ–¥—Ä–∞–∑—É
            if (isAndroid) {
                setTimeout(() => {
                    showPWAToast();
                }, 2000);
            }
            // –î–ª—è iOS –ø–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É
            else if (isIOS) {
                installButton.style.display = 'block';
            }
        });

        // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            if (deferredPrompt && isAndroid) {
                showPWAToast();
            }
        }, 5000);

        function showPWAToast() {
            if (deferredPrompt && !isIOS) {
                pwaToast.classList.add('show');
                console.log('PWA toast shown');
            }
        }

        function hidePWAToast() {
            pwaToast.classList.remove('show');
        }

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    console.log('User choice:', choiceResult.outcome);
                    if (choiceResult.outcome === 'accepted') {
                        hidePWAToast();
                        installButton.style.display = 'none';
                    }
                    deferredPrompt = null;
                });
            }
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –≤–∂–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫
        window.addEventListener('appinstalled', (evt) => {
            console.log('–î–æ–¥–∞—Ç–æ–∫ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
            hidePWAToast();
            installButton.style.display = 'none';
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ö–æ–≤–∞—î–º–æ —Å–ø–ª–∏–≤–∞—é—á–µ –≤—ñ–∫–Ω–æ —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥
        setTimeout(hidePWAToast, 15000);

        // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—ñ–≤
        clickerImg.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleClick();
            clickerImg.style.transform = 'scale(0.9)';
        });

        clickerImg.addEventListener('touchend', (e) => {
            e.preventDefault();
            clickerImg.style.transform = 'scale(1)';
        });

        clickerImg.addEventListener('click', () => {
            handleClick();
            clickerImg.style.transform = 'scale(0.9)';
            setTimeout(() => {
                clickerImg.style.transform = 'scale(1)';
            }, 100);
        });

        // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
        setInterval(() => {
            localStorage.setItem('clickCount', count);
            localStorage.setItem('gameCoins', coins);
        }, 1000);

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        updateCounter();
        statusElement.textContent = '–ì—Ä–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞! –¢–∏—Å–Ω–∏ –Ω–∞ Rico üëÜ';

        // Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π:', registration);
                        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π PWA
                        checkPWAStatus();
                    })
                    .catch(error => {
                        console.log('–ü–æ–º–∏–ª–∫–∞ Service Worker:', error);
                    });
            });
        }

        function checkPWAStatus() {
            // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–ª—è Android
            if (isAndroid && !deferredPrompt) {
                setTimeout(() => {
                    if (window.matchMedia('(display-mode: standalone)').matches) {
                        console.log('–í–∂–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                    } else {
                        console.log('PWA –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è');
                        // –°–ø—Ä–æ–±—É—î–º–æ –ø–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–ª–∏–≤–∞—é—á–µ –≤—ñ–∫–Ω–æ —â–µ —Ä–∞–∑
                        showPWAToast();
                    }
                }, 3000);
            }
        }

        // –õ–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥–µ–±–∞–≥—É
        console.log('User Agent:', navigator.userAgent);
        console.log('Is Android:', isAndroid);
        console.log('Is iOS:', isIOS);
    </script>
</body>
</html>
